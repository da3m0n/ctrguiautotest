<html>
<head>
    <title>Smoke Tests</title>
    <meta http-equiv="refresh" content="43200"/>
    <!--<link rel="stylesheet" href="vendor/css/screen.css">-->
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="smoketests.css"/>
    <link rel="stylesheet" href="vendor/css/lightbox.css">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
</head>
<body>
<div class="jumbotron" id="jumbo-enhancements">
    <div id="test-result"></div>
</div>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header navbar-inverse">
            <span class="navbar-brand pull-left"><a href="\">CTR Smoketests</a></span>
        </div>
        <div id="coverage-result" class="pull-right"><strong>Test Coverage</strong>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div id="dates" class="col-lg-3"></div>
        <div id="tests" class="col-lg-9"></div>
    </div>
</div>

<script src="utils.js"></script>
<script>
//    var sortedDates = utils.getLatestTest("logs/testDates.xml");
//    for (var latest in sortedDates) {
//        var newDate = latest.date.split(' ').join('_');
//        var newDateXml = newDate + '.xml';
//
//
//        utils.displayResult("logs/" + newDate + "/smoketest/" + newDateXml, "coverage.xsl", "coverage-result");
//        utils.displayResult("logs/" + newDate + "/smoketest/" + newDateXml, "overallResult.xsl", "test-result");
//        utils.displayResult("logs/testDates.xml", "dates.xsl", "dates");
//        utils.displayResult("logs/" + newDate + "/smoketest/" + newDateXml, "results.xsl", "tests");
//        break;
//    }

    var sortedDates = utils.getLatestTest("logs/testDates.xml");
    var allTests = [{dir: 'smoketest', name : 'smoketest' }];
    for (var testi in allTests) {
        var test = allTests[testi];
        var found = false;
        for (var li in sortedDates) {
            var latest = sortedDates[li];

            var newDate = latest.date.split(' ').join('_');
            var newDateXml = newDate + '.xml';
            var data = utils.getResult("logs/" + newDate + "/" + test.dir + "/" + newDateXml);
            if (data) {
            console.log(data);
                utils.displayResult(data, "coverage.xsl", test.name);
                utils.displayResult(data, "overallResult.xsl", test.name + "-run");
                found = true;
                break;
            }
        }
        if (!found) {
                utils.displayResult(data, "coverage.xsl", test.name);
                utils.displayResult(data, "overallResult.xsl", test.name + "-run");
        }
    }

</script>
<script>

    $(".datesListener").on('click', function (e) {
        var date = $(this).attr('href');
        e.preventDefault();
        $('#tests').empty();
        loadNewResults(date);
    });


    function loadNewResults(date) {
        utils.displayResult(date, 'results.xsl', 'tests');
    }
</script>
</body>
</html>